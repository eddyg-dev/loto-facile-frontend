<ion-header mode="ios" collapse="fade">
  <ion-toolbar mode="ios" class="ion-no-border">
    <ion-buttons slot="start">
      <ion-button color="medium" (click)="close()">Annuler</ion-button>
    </ion-buttons>
    @if (tempGrids.length && categoryId) {
    <ion-buttons slot="end">
      <ion-button
        color="medium"
        [disabled]="!tempGrids.length"
        (click)="validate()"
        >Valider l'import</ion-button
      >
    </ion-buttons>
    }
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" [fullscreen]="true">
  <div class="premium-info ion-text-center">
    @if (!tempGrids.length) {
    <ion-icon name="star" color="warning" style="font-size: 24px"></ion-icon>
    <p>
      Ces fonctionnalités <strong>Premium</strong> vous permettent d'importer
      automatiquement plusieurs cartons à partir d'une <strong>photo</strong> ou
      d'un <strong>fichier</strong>. Gagnez du temps et assurez-vous d'une
      analyse rapide et précise. Fonctionne avec n'importe quel type de Loto.
    </p>
    } @else {
    <p>
      Seuls les cartons bien détectés par l'IA sont visibles.
      <br />
      Veuillez bien vérifier les cartons avant de valider.
    </p>
    <p>
      Si des cartons sont mal détectés, vous pouvez toujours les ajouter ou
      modifier manuellement.
      <br />
    </p>
    }
  </div>
  <ion-grid>
    <ion-row>
      <!-- Bloc pour Prendre une photo -->
      <ion-col class="column-info" size="6">
        <div class="button-container">
          <ion-button
            [disabled]="isImporting()"
            expand="block"
            size="large"
            color="primary"
            (click)="selectPhotoPremium()"
            class="button-block"
          >
            <div class="button-content">
              <ion-icon
                name="camera-outline"
                style="font-size: 48px"
              ></ion-icon>
              <span class="button-label">Prendre ou choisir une photo</span>
            </div>
          </ion-button>
          <ion-button
            class="info-button"
            fill="clear"
            size="small"
            color="light"
            (click)="presentPhotoInfo()"
          >
            <ion-icon
              name="information-circle-outline"
              style="font-size: 24px"
            ></ion-icon>
          </ion-button>
        </div>
      </ion-col>

      <!-- Bloc pour Importer un fichier -->
      <ion-col class="column-info" size="6">
        <div class="button-container">
          <ion-button
            [disabled]="isImporting()"
            expand="block"
            size="large"
            color="secondary"
            (click)="onFileInputClick()"
            class="button-block"
          >
            <div class="button-content">
              <ion-icon
                name="document-attach-outline"
                style="font-size: 48px"
              ></ion-icon>
              <span class="button-label"
                >Importer un fichier (PDF, CSV, XLSX)</span
              >
            </div>
          </ion-button>
          <ion-button
            class="info-button"
            fill="clear"
            size="small"
            color="medium"
            (click)="presentFileInfo()"
          >
            <ion-icon
              name="information-circle-outline"
              style="font-size: 24px"
            ></ion-icon>
          </ion-button>
        </div>

        <!-- Input caché pour le fichier, déclenché par le bouton ci-dessus -->
        <input
          type="file"
          accept=".pdf, .csv, .xlsx, image/*"
          (change)="onFileSelected($event)"
          hidden
          #fileInput
        />
      </ion-col>
    </ion-row>
  </ion-grid>

  @if (isImporting()) {
  <app-page-loader />
  <div class="ion-text-center">Analyse IA du fichier en cours</div>
  <div class="ion-text-center">Veuillez patienter...</div>
  <div class="ion-text-center">
    Ce processus peut prendre quelques secondes...
  </div>
  <app-page-loader />

  } @if (tempGrids.length && !isImporting()) {
  <ion-item>
    <ion-label>Catégorie</ion-label>
    <ion-select
      mode="ios"
      placeholder="Sélectionner une catégorie"
      [(ngModel)]="categoryId"
      (ngModelChange)="update()"
      interface="popover"
    >
      <ion-select-option
        *ngFor="let category of categories$ | async"
        [value]="category.id"
      >
        {{ category.name }}
      </ion-select-option>
    </ion-select>
  </ion-item>
  <ion-button (click)="openSaveCategoryModal()" size="small">
    <ion-icon slot="start" name="add"></ion-icon>
    AJOUTER UNE CATEGORIE
  </ion-button>
  <div class="parent">
    @for (grid of tempGrids; track $index) {
    <app-grid-full
      [grid]="grid"
      [isSelectableForPlay]="false"
      [isSelectableForEdit]="false"
      [isEditable]="false"
      [displayBadges]="false"
      [isTemp]="true"
      [indexTemp]="$index"
      (deleteTempGrid)="deleteTempGrid($index)"
    />
    }
  </div>
  }
</ion-content>
