<ion-header mode="ios" collapse="fade">
  <ion-toolbar mode="ios" class="ion-no-border">
    <ion-buttons slot="start">
      <ion-button color="medium" (click)="close()">Annuler</ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button
        color="success"
        [disabled]="!isGridValid()"
        (click)="confirm()"
        >Valider</ion-button
      >
    </ion-buttons>
    <ion-title class="ion-text-center">{{
      grid ? "Carton N° " + grid.numero : "Nouveau"
    }}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding" class="my-content" [fullscreen]="true">
  <div class="flex-column">
    <ion-item>
      <ion-input
        size="large"
        id="numero-input"
        labelPlacement="stacked"
        label="Numéro du carton"
        [(ngModel)]="numero"
        placeholder="Numéro"
        mode="ios"
        type="text"
        (ionFocus)="isNumeroInputFocusedChange()"
        (ionBlur)="isNumeroInputFocused.set(false)"
      ></ion-input>
    </ion-item>
  </div>

  @if (numero) {
  <div>
    <ion-item>
      <ion-label>Catégorie</ion-label>
      <ion-select
        mode="ios"
        placeholder="Catégorie"
        [(ngModel)]="category"
        interface="popover"
        cancelText="Annuler"
      >
        <ion-select-option
          *ngFor="let category of categories$ | async"
          [value]="category.id"
          >{{ category.name }}</ion-select-option
        >
      </ion-select>
    </ion-item>
  </div>
  } @if (numero && category) {

  <div>
    <ion-list class="grid-container">
      <div class="quine-bloc">
        <ion-list-header>
          <ion-label class="list-header">Quine 1</ion-label>
        </ion-list-header>

        <ion-item lines="none">
          <ion-input
            #field1
            id="field1"
            [(ngModel)]="field1Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field1"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field1Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field1, field2)"
          ></ion-input>
          <ion-input
            #field2
            id="field2"
            [(ngModel)]="field2Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field2"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field2Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field2, field3)"
          ></ion-input>
          <ion-input
            #field3
            id="field3"
            [(ngModel)]="field3Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field3"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field3Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field3, field4)"
          ></ion-input>
          <ion-input
            #field4
            id="field4"
            [(ngModel)]="field4Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field4"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field4Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field4, field5)"
          ></ion-input>
          <ion-input
            #field5
            id="field5"
            [(ngModel)]="field5Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field5"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field5Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field5, field6)"
          ></ion-input>
        </ion-item>
      </div>

      <div class="quine-bloc">
        <ion-list-header>
          <ion-label class="list-header">Quine 2</ion-label>
        </ion-list-header>
        <ion-item lines="none">
          <ion-input
            #field6
            id="field6"
            [(ngModel)]="field6Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field6"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field6Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field6, field7)"
          ></ion-input>
          <ion-input
            #field7
            id="field7"
            [(ngModel)]="field7Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field7"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field7Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field7, field8)"
          ></ion-input>
          <ion-input
            #field8
            id="field8"
            [(ngModel)]="field8Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field8"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field8Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field8, field9)"
          ></ion-input>
          <ion-input
            #field9
            id="field9"
            [(ngModel)]="field9Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field9"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field9Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field9, field10)"
          ></ion-input>

          <ion-input
            #field10
            id="field10"
            [(ngModel)]="field10Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field10"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field10Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field10, field11)"
          ></ion-input>
        </ion-item>
      </div>
      <div class="quine-bloc">
        <ion-list-header>
          <ion-label class="list-header">Quine 3</ion-label>
        </ion-list-header>
        <ion-item lines="none">
          <ion-input
            #field11
            id="field11"
            [(ngModel)]="field11Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field11"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field11Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field11, field12)"
          ></ion-input>
          <ion-input
            #field12
            id="field12"
            [(ngModel)]="field12Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field12"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field12Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field12, field13)"
          ></ion-input>
          <ion-input
            #field13
            id="field13"
            [(ngModel)]="field13Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field13"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field13Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field13, field14)"
          ></ion-input>
          <ion-input
            #field14
            id="field14"
            [(ngModel)]="field14Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field14"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field14Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field14, field15)"
          ></ion-input>
          <ion-input
            #field15
            id="field15"
            [(ngModel)]="field15Value"
            class="quine-number"
            [class.has-focus]="currentFieldInput === field15"
            type="number"
            inputmode="numeric"
            fill="outline"
            shape="round"
            [class.filled]="field15Value"
            placeholder="_"
            (ionFocus)="onInputFocus(field15)"
          ></ion-input>
        </ion-item>
      </div>
    </ion-list>

    @if (showKeyboard()) {
    <div class="keyboard">
      <app-ninety-keyboard
        [hasHeader]="false"
        [isManual]="true"
        [values]="getAllValues()"
        (clickOnNumber)="onNumberClick($event)"
      />
    </div>
    } @if (isAllValuesDefined()) {
    <div class="errors">
      <ul>
        <li class="error-text" [class.valid]="isValidOneToNinety()">
          Toutes les valeurs doivent être comprises entre 1 et 90
        </li>
        <li class="error-text" [class.valid]="isNumbersDifferent()">
          Il doit y avoir 15 numéros différents sur votre grille
        </li>
        <li
          class="error-text"
          [class.valid]="isSorted1() && isSorted2() && isSorted3()"
        >
          Chaque quine doit être rangée par ordre croissant
        </li>
        <li
          class="error-text"
          [class.valid]="
            isDifferentDizaine1() &&
            isDifferentDizaine2() &&
            isDifferentDizaine3()
          "
        >
          Chaque quine doit comporter des dizaines différentes
        </li>
      </ul>
    </div>
    }
  </div>
  }
</ion-content>
